<template>
  <div id="grab-cashback">
    <head-top class="header">
      <i slot="left" class="prev iconfont icon-back"></i>
      <div slot="title" class="head-title">Grab Additional Cashback</div>
      <i slot="right" class="sp iconfont icon-back"></i>
    </head-top>
    <div class="content">
      <div class="appTop" v-show="isShowBtn"></div>
      <div class="top-banner">
        <img :src="mUrl" :alt="mAlt" :title="mTitle">
      </div>
      <div class="part-total">
        <div class="total-box">
          <h5>Grand Total</h5>
          <ul class="flex space-between">
            <li>
              <!-- <p>{{String(total.allCount?total.allCount:'0') | formatDate}}</p> -->
              <p><number-scroll :time="1" :value="allCount"></number-scroll></p>
              <p>Participation</p>
            </li>
            <li>
              <!-- <p><span class="rs">Rs</span>{{String(total.allAmount?total.allAmount:'0') | formatDate}}</p> -->
              <p class="flex"><span class="rs">Rs</span><number-scroll :time="3" :value="allAmount"></number-scroll></p>
              <p>Extra Cashback</p>
            </li>
            <li>
              <!-- <p>{{String(total.AllUser?total.AllUser:'0') | formatDate}}</p> -->
              <p><number-scroll :time="1" :value="AllUser"></number-scroll></p>
              <p>Helps Received</p>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="part-bottom">
      <div class="book-des">Book To Win Cashback or Check Your Ongoing Rewards</div>
      <div class="book-btns">
        <button @click="bookNow">Book Now</button>
        <button @click="checkNow">Check Now</button>
      </div>
    </div>
    <div class="part-terms">
      <h3>Grab Additional Cashback On Your Booking</h3>
      <p class="p-content" style="margin:0.534rem 0 0.769rem ; ">This program is effiective on the latest version of the Andoird &amp; iOS APP.Our APP provides convenient methods of invite, and also can view your cashback progress in real time.</p>
      <h3>Terms &amp; Conditions</h3>
      <p></p>
      <ul>
        <li>
          <p class="p-title">1.Qualification Criteria :</p>
          <p class="p-content">There is a random probability of a user being selected for the opportunity to win cashback,after payment for booking has been successfully made.</p>
        </li>
        <li>
          <p class="p-title">2.Validity Period :</p>
          <p class="p-content">A user can invite friends to get helps for up to 24 hours. The invitations are closed at the end of this time window or when the maximum number of invitations is reached. When you cancel the order or the order cannot be issued,the invitations will also be closed.</p>
          <p class="p-content">The validity periods of different cashback chances are independent of each other. </p>
        </li>
        <li>
          <p class="p-title">3.Cashback Amount :</p>
          <p class="p-content">The amount of cashback a user can win on a booking and the maximum number of people that can be invited are automatically generated by the Marketing Policy. This cashback rewards are independent of other product or activity rewards.</p>
          <p class="p-content">Each time you receive a help, you will receive a random amount of cashback.The cashback bonus will reach the upper limit when you invite the maximum number of friends on a booking.</p>
        </li>
        <li>
          <p class="p-title">4.When Will Cashback Arrive :</p>
          <p class="p-content">Only after an order has been issued,Cashback are reflected in the your HappyGold Amount,then everytime your received a help ,You'll get  the reward immediately.</p>
        </li>
        <li>
          <p class="p-title">5.Invitations :</p>
          <p class="p-content">A user can only invite people who are not registered on HappyEasyGo. An invitation is counted successful only after the phone number of the invitee has been verified.When you invite your friends, they can view information about the itinerary and amount of the order;</p>
          <p class="p-content">Note: Friends invited via this offer are not considered valid referrals under the Refer & Earn programme.</p>
        </li>
        <li>
          <p class="p-title">6.How to Use the Cashback(HappyGold) :</p>
          <p class="p-content">You can pay your bookings by Happy Gold( (1 Gold = 1 Rupee). Happy Gold received via this offer cannot be transferred to bank A/C.</p>
        </li>
        <li>
          <p class="p-title">7.Order Cancellation :</p>
          <p class="p-content">In case the order cannot be issued, the cashback will be cancelled. However, It does not affect the normal refund process. </p>
        </li>
        <li>
          <p class="p-title">8.Participating in this programme and inviting your friends to win cash indicates an agreement to all the terms and conditions. </p>
        </li>
        <li>
          <p class="p-title">9.The right of final interpretation of this offer is reserved with HappyEasyGo. </p>
        </li>
      </ul>
    </div>
  </div>
</template>
<script>
import headTop from "../../components/head/head.vue";
import numberScroll from "../../components/number-scroll/number-scroll.vue";
import { CookieUtil } from "../../models/utils";
import { User } from "../../models/user";
import { DomainManager } from "../../config/DomainManager.js";
import { Toast,Indicator } from 'mint-ui';
import { AppBridge } from '../../models/appbridge/appbridge.js';
import { Activity } from "../../models/activity";
export default {
  components:{
    headTop,
    numberScroll,
  },
  data(){
    return {
      total:{},
      model:0,
      mUrl: "",
      mAlt: "",
      mTitle: "",
      isShowBtn: false,
    }
  },
  computed: {
    allCount(){
      return Number(this.total != {}?this.total.allCount:0);
    },
    allAmount(){
      return Number(this.total != {}?this.total.allAmount:0);
    },
    AllUser(){
      return Number(this.total != {}?this.total.AllUser:0);
    },
  },
  methods:{
    bookNow(){
      try {
        window.heg.trackEvent("AC_Grab_Offer_Booknow");
      } catch (error) {
        if(window.WebViewJavascriptBridge){
          this.$bridge.callhandler("trackEvent","AC_Grab_Offer_Booknow");
        }
      }
      AppBridge.goHomePage(this);
    },
    checkNow(){
      try {
        window.heg.trackEvent("AC_Grab_Offer_Checknow");
      } catch (error) {
        if(window.WebViewJavascriptBridge){
          this.$bridge.callhandler("trackEvent","AC_Grab_Offer_Checknow");
        }
      }
      if(this.isShowBtn){
        window.open('https://app.adjust.com/for04bk?campaign=offer&adgroup=Msite&creative=Online');
      }else{
        this.$router.push('/grab-app-share');
      }
    },
    checkType() {
      let type = AppBridge.device;
      if(type == 1){
        this.model = 2;
      }else if(type == 2){
        this.model = 3;
      }else{
        this.model = 0;
      }
      this.getImg();
    },
    getImg() {
      let parmTop = "type=13&device=" + this.model + "&addr=grab-cashback&businessType=1";
      User.advList(this, parmTop).then(res => {
        if (res.success) {
          this.mUrl =
            res.list[0].landingPageUrl == null
              ? ""
              : res.list[0].landingPageUrl;
          this.mAlt =
            res.list[0].landingPageAlt == null
              ? ""
              : res.list[0].landingPageAlt;
          this.mTitle =
            res.list[0].landingPageTitle == null
              ? ""
              : res.list[0].landingPageTitle;
        }
      }).catch(err => {
        console.log(err.msg);
      });
    },
  },
  async created() {
    this.isShowBtn = await AppBridge.getNativeSource(this);
    this.checkType();
    Activity.grabCashbackSale(this).then(res => {
      if(res.succ && res.data.status){
        this.total = res.data;
      }else{
        Toast(res.msg);
      }
    }).catch(err => {
      console.log(err);
    })
  },

}
</script>
<style lang="less" scoped>
#grab-cashback{
  .sp {
    opacity: 0;
  }
  .content{
    img{
      width:100%;
      vertical-align: top;
    }
    .appTop{
      margin-top:2.04rem;
    }
    .top-banner{
      width:100%;
    }
  }
  .part-total{
    position: relative;
  }
  .total-box{
    position: absolute;
    width:92%;
    top:-0.641rem;
    margin:0 0.64rem;
    border-radius:3px;
    border:1px solid #eee;
    box-shadow:0 3px 5px #eee;
    h5{
      color:#0b9d78;
      font-size: 0.512rem;
      line-height:0.982rem;
      background:#fff;
    }
    ul{
      background:#f3faf8;
      padding:0.3rem 0;
    }
    li{
      flex:1;
      p{
        justify-content: center;
        line-height:0.982rem;
        border-right:1px solid #c5e7de ;
      }
      p:first-child{
        font-size: 0.641rem;
        color:#f02f58;
        font-weight: bold;
      } 
      p:last-child{
        color:#bcbcbc;
        font-size: 0.512rem;
      } 
    }
    li:last-child p{
      border:0;
    }
  }
  .part-bottom{
    margin-top:4rem;
  }
  .book-des{
    font-size:0.512rem;
    color:#000;
  }
  .book-btns{
    margin: 0.854rem 0 1.23rem;
    button{
      font-size: 0.598rem;
      width:5.98rem;
      height:1.495rem;
      line-height:1.495rem;
      color:#fff;
      border-radius:3px;
      cursor: pointer;
    }
    button:first-child{background:#ffad3d;margin-right:0.641rem;}
    button:last-child{background:#0b9d78;}
  }
  .part-terms{
    margin:0 0.64rem 1.495rem;
    text-align: left;
    h3{
      font-size: 0.598rem;
      color:#333;
      font-weight: bold;
    }
    p{
      letter-spacing:0.3px;
      font-family: "Helvetical TPro Light";
    }
    .p-title{
      font-size: 0.598rem;
      line-height:0.769rem;
      color:#666;
      margin:0.769rem 0 0.534rem; 
    }
    .p-content{
      font-size: 0.512rem;
      line-height:0.769rem;
      color:#999;
    }
  }
}
</style>
